<!doctype html>
<html lang="fr" data-theme="system">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>√âditeur IA ‚Ä¢ √âditeur de code assist√© par IA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/eclipse.min.css" />
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <!-- Barre sup√©rieure -->
    <header class="topbar">
      <div class="title">
        <span class="logo">üìù</span>
        <span>√âditeur IA</span>
      </div>
      <div class="actions">
        <button id="logsBtn" class="btn btn-outline-secondary btn-sm">Historique</button>
        <button id="settingsBtn" class="btn btn-primary btn-sm">Param√®tres</button>
      </div>
    </header>

    <!-- Layout principal: 3 zones -->
    <main class="editor-layout">
      <!-- Zone 1: Explorateur de fichiers (haut gauche) -->
      <aside class="file-explorer">
        <div class="explorer-header">
          <h6 class="mb-0">Explorateur</h6>
          <div class="explorer-actions">
            <button id="newFileBtn" class="btn btn-sm btn-success" title="Nouveau fichier">‚ûï</button>
            <button id="uploadFileBtn" class="btn btn-sm btn-primary" title="Importer fichier">üì§</button>
            <button id="refreshFiles" class="btn btn-sm btn-outline-secondary" title="Rafra√Æchir">‚ü≥</button>
          </div>
        </div>
        <div id="fileTree" class="file-tree">
          <div class="text-muted text-center py-3">Chargement...</div>
        </div>
      </aside>

      <!-- Zone 2: √âditeur de code (haut droite) -->
      <section class="code-editor">
        <!-- Barre d'onglets -->
        <div id="tabBar" class="tab-bar">
          <div class="tabs-container" id="tabsContainer">
            <!-- Les onglets seront ajout√©s dynamiquement ici -->
          </div>
        </div>

        <div class="editor-header">
          <div class="file-info">
            <span id="currentFileName" class="file-name">Aucun fichier ouvert</span>
            <span id="fileStatus" class="file-status"></span>
          </div>
          <div class="editor-actions">
            <button id="saveBtn" class="btn btn-sm btn-success" disabled>Sauvegarder</button>
            <button id="saveAllBtn" class="btn btn-sm btn-success" disabled>Tout sauvegarder</button>
            <button id="closeFileBtn" class="btn btn-sm btn-outline-secondary" disabled>Fermer</button>
            <button id="closeAllBtn" class="btn btn-sm btn-outline-secondary" disabled>Tout fermer</button>
          </div>
        </div>
        <div id="editorContainer" class="editor-container">
          <div class="empty-state">
            <p class="text-muted">S√©lectionnez un fichier dans l'explorateur pour commencer</p>
          </div>
        </div>
        <!-- Zone de diff pour validation -->
        <div id="diffViewer" class="diff-viewer" style="display: none;">
          <div class="diff-header">
            <h6>Modifications propos√©es par l'IA</h6>
            <div>
              <button id="acceptDiff" class="btn btn-sm btn-success">Accepter</button>
              <button id="rejectDiff" class="btn btn-sm btn-danger">Refuser</button>
            </div>
          </div>
          <div id="diffContent" class="diff-content"></div>
        </div>
      </section>

      <!-- Zone 3: Chat IA (bas) -->
      <section class="chat-panel">
        <div class="chat-header">
          <h6 class="mb-0">Assistant IA</h6>
          <button id="clearChat" class="btn btn-sm btn-outline-secondary">Effacer</button>
        </div>
        <div id="chatMessages" class="chat-messages"></div>
        <form id="chatForm" class="chat-composer">
          <textarea
            id="chatInput"
            rows="2"
            class="form-control"
            placeholder="Demandez √† l'IA de modifier le code... (Shift+Entr√©e pour nouvelle ligne)"
          ></textarea>
          <div class="d-flex gap-2 mt-2">
            <button id="sendBtn" class="btn btn-primary" type="submit">Envoyer</button>
            <button id="stopBtn" class="btn btn-outline-danger" type="button" disabled>Arr√™ter</button>
          </div>
        </form>
      </section>
    </main>

    <!-- Modal Param√®tres -->
    <dialog id="settingsModal" class="modal-box">
      <form method="dialog" class="modal-inner" id="settingsForm">
        <h5 class="mb-3">Param√®tres</h5>
        <div class="mb-2">
          <label class="form-label">Cl√© API OpenRouter</label>
          <input id="apiKey" class="form-control" type="password" placeholder="sk-or-..." />
        </div>
        <div class="mb-2">
          <label class="form-label">Mod√®le</label>
          <select id="model" class="form-select">
            <option value="openrouter/auto">Auto (recommand√©)</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="form-label">Th√®me √©diteur</label>
          <select id="editorTheme" class="form-select">
            <option value="dracula">Dracula (sombre)</option>
            <option value="eclipse">Eclipse (clair)</option>
            <option value="default">D√©faut</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="form-label">Th√®me interface</label>
          <select id="themeSelect" class="form-select">
            <option value="system">Syst√®me</option>
            <option value="dark">Sombre</option>
            <option value="light">Clair</option>
          </select>
        </div>
        <div class="d-flex gap-2 mt-3">
          <button type="button" id="loadModels" class="btn btn-outline-secondary">Charger mod√®les</button>
          <div class="flex-fill"></div>
          <button type="button" id="cancelSettings" class="btn btn-outline-secondary">Annuler</button>
          <button type="submit" class="btn btn-primary">Sauvegarder</button>
        </div>
      </form>
    </dialog>

    <!-- Modal Logs -->
    <dialog id="logsModal" class="modal-box">
      <div class="modal-inner">
        <h5>Historique des modifications</h5>
        <div id="logsList" class="logs-list mt-3"></div>
        <div class="mt-3 text-end">
          <button id="closeLogs" class="btn btn-primary">Fermer</button>
        </div>
      </div>
    </dialog>

    <!-- Modal Nouveau fichier -->
    <dialog id="newFileModal" class="modal-box">
      <form method="dialog" class="modal-inner" id="newFileForm">
        <h5 class="mb-3">Cr√©er un nouveau fichier</h5>
        <div class="mb-3">
          <label class="form-label">Nom du fichier</label>
          <input id="newFileName" class="form-control" type="text" placeholder="exemple.php" required />
          <small class="text-muted">Avec extension: .php, .html, .css, .js</small>
        </div>
        <div class="mb-3">
          <label class="form-label">Dossier (optionnel)</label>
          <input id="newFileFolder" class="form-control" type="text" placeholder="subfolder/" />
          <small class="text-muted">Laissez vide pour cr√©er √† la racine de page/</small>
        </div>
        <div class="mb-3">
          <label class="form-label">Template</label>
          <select id="newFileTemplate" class="form-select">
            <option value="html">HTML (avec structure compl√®te)</option>
            <option value="php">PHP (avec en-t√™te)</option>
            <option value="css">CSS (avec commentaires)</option>
            <option value="js">JavaScript (avec commentaires)</option>
            <option value="blank">Vide</option>
          </select>
        </div>
        <div class="d-flex gap-2">
          <button type="button" id="cancelNewFile" class="btn btn-outline-secondary">Annuler</button>
          <button type="submit" class="btn btn-success">Cr√©er</button>
        </div>
      </form>
    </dialog>

    <!-- Modal Upload fichier -->
    <dialog id="uploadModal" class="modal-box">
      <div class="modal-inner">
        <h5 class="mb-3">Importer un fichier</h5>
        <form id="uploadForm">
          <div class="mb-3">
            <label class="form-label">Fichier √† importer</label>
            <input id="uploadFileInput" class="form-control" type="file" accept=".php,.html,.htm,.css,.js,.json,.txt,.md,.xml,.svg,.jpg,.jpeg,.png,.gif,.webp" required />
            <small class="text-muted">Max 10 Mo ‚Ä¢ Extensions: php, html, css, js, json, txt, md, xml, svg, images</small>
          </div>
          <div class="mb-3">
            <label class="form-label">Dossier de destination (optionnel)</label>
            <input id="uploadFolder" class="form-control" type="text" placeholder="subfolder/" />
            <small class="text-muted">Laissez vide pour importer √† la racine de page/</small>
          </div>
          <div id="uploadProgress" class="progress mb-3" style="display: none;">
            <div id="uploadProgressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
          </div>
          <div class="d-flex gap-2">
            <button type="button" id="cancelUpload" class="btn btn-outline-secondary">Annuler</button>
            <button type="submit" class="btn btn-primary">Importer</button>
          </div>
        </form>
      </div>
    </dialog>

    <!-- Scripts CodeMirror -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/php/php.min.js"></script>

    <!-- Modules applicatifs -->
    <script src="./js/state.js" type="module"></script>
    <script src="./js/api.js" type="module"></script>
    <script src="./js/fileExplorer.js" type="module"></script>
    <script src="./js/fileManager.js" type="module"></script>
    <script src="./js/editor.js" type="module"></script>
    <script src="./js/diff.js" type="module"></script>
    <script src="./js/chat.js" type="module"></script>
    <script src="./js/app.js" type="module"></script>
  </body>
</html>
