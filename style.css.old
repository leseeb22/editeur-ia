/* Bootstrap-based look + custom theme variables */
:root,
[data-theme="dark"] {
  --bg: #0b1220;
  --panel: #0f172a;
  --text: #e5e7eb;
  --muted: #9ca3af;
  --accent: #3b82f6;
  --accent-contrast: #0b1220;
  --assistant: #111827;
  --user: #1f2937;
  --border: #1f2937;
  --shadow: rgba(0,0,0,0.35);
  --control-bg: #0b1220;
  --control-border: #1f2937;
  --control-text: #e5e7eb;
  --btn-secondary: #111827;
  --danger: #ef4444;
  --danger-contrast: #0b1220;
}

[data-theme="light"] {
  --bg: #f8fafc;
  --panel: #ffffff;
  --text: #0f172a;
  --muted: #64748b;
  --accent: #2563eb;
  --accent-contrast: #ffffff;
  --assistant: #f1f5f9;
  --user: #eff6ff;
  --border: #e2e8f0;
  --shadow: rgba(0,0,0,0.08);
  --control-bg: #ffffff;
  --control-border: #cbd5e1;
  --control-text: #0f172a;
  --btn-secondary: #f3f4f6;
  --danger: #dc2626;
  --danger-contrast: #ffffff;
}

:root[data-theme="system"] {}
@media (prefers-color-scheme: light) {
  :root[data-theme="system"] {
    --bg: #f8fafc;
    --panel: #ffffff;
    --text: #0f172a;
    --muted: #64748b;
    --accent: #2563eb;
    --accent-contrast: #ffffff;
    --assistant: #f1f5f9;
    --user: #eff6ff;
    --border: #e2e8f0;
    --shadow: rgba(0,0,0,0.08);
    --control-bg: #ffffff;
    --control-border: #cbd5e1;
    --control-text: #0f172a;
    --btn-secondary: #f3f4f6;
    --danger: #dc2626;
    --danger-contrast: #ffffff;
  }
}

html, body { height: 100%; }
body { background: var(--bg); color: var(--text); }
* { box-sizing: border-box; }

.topbar {
  position: sticky;
  top: 0;
  z-index: 10;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 12px;
  background: var(--bg);
  border-bottom: 1px solid var(--border);
}
.title { font-weight: 600; }
.title a { color: inherit; text-decoration: none; }
.title a:hover { text-decoration: underline; }
.actions { display: flex; gap: .5rem; }

.chat { display: flex; flex-direction: column; gap: .75rem; }
.msg { display: flex; gap: .75rem; padding: .75rem; border: 1px solid var(--border); border-radius: .75rem; line-height: 1.55; box-shadow: 0 1px 2px var(--shadow); }
.msg.assistant { background: var(--assistant); }
.msg.user { background: var(--user); }
.msg .role { flex: 0 0 auto; font-weight: 600; color: var(--muted); width: 74px; }
.msg .content { white-space: pre-wrap; word-wrap: break-word; overflow-wrap: anywhere; }
.msg .meta { color: var(--muted); font-size: 12px; margin-top: 6px; }

.composer {
  position: sticky;
  bottom: 0;
  background: linear-gradient(180deg, color-mix(in oklab, var(--bg), transparent 0%), var(--bg) 35%);
  padding-bottom: 1rem;
  display: grid; grid-template-columns: 1fr; gap: .5rem;
}

.modal-box { border: none; padding: 0; background: transparent; }
.modal-box::backdrop { background: rgba(0,0,0,0.4); backdrop-filter: blur(2px); }
.modal-inner { background: var(--panel); border: 1px solid var(--border); border-radius: .75rem; padding: 1rem; width: min(620px, 92vw); }

.history-list { display: grid; gap: 8px; max-height: 50vh; overflow: auto; }
.history-item { display: grid; grid-template-columns: 1fr auto; gap: 8px; align-items: center; padding: 10px; border: 1px solid var(--border); border-radius: 10px; background: var(--panel); }
.history-item .meta { color: var(--muted); font-size: 12px; }
.history-item .title { font-weight: 600; }
.history-item .actions { display: flex; gap: 6px; }

/* Spinner for meta */
.spinner {
  display: inline-block; width: 14px; height: 14px;
  border: 2px solid var(--muted); border-top-color: var(--accent);
  border-radius: 50%; animation: spin .8s linear infinite; vertical-align: -2px; margin-right: 6px;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* Skeleton shimmer */
.skeleton { display: grid; gap: 8px; }
.skeleton .line { height: 12px; border-radius: 6px; background: linear-gradient(90deg,
  color-mix(in oklab, var(--control-bg), #fff 4%) 25%,
  color-mix(in oklab, var(--control-bg), #fff 16%) 37%,
  color-mix(in oklab, var(--control-bg), #fff 4%) 63%);
  background-size: 400% 100%; animation: shimmer 1.1s ease-in-out infinite; }
.skeleton .line.wide { height: 14px; }
.skeleton .line.short { width: 60%; }
@keyframes shimmer { 0% { background-position: 100% 0; } 100% { background-position: 0 0; } }

/* Button loading dots and spinner */
.btn.loading { position: relative; }
.btn .btn-spinner { display: inline-block; width: 12px; height: 12px; border: 2px solid currentColor; border-top-color: transparent; border-radius: 50%; animation: spin .8s linear infinite; margin-right: 8px; vertical-align: -2px; }

/* Form control colors respecting theme */
.form-control, .form-select, .form-control:focus, .form-select:focus { background-color: var(--control-bg); color: var(--control-text); border-color: var(--control-border); }
.form-control:focus, .form-select:focus { box-shadow: 0 0 0 .2rem color-mix(in oklab, var(--accent), transparent 75%); border-color: var(--accent); }

